<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Model Gallery | QuadSpectat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap">
  <style>
    :root {
      --primary-green: #c1f120;
      --primary-dark: #373a39;
      --primary-gray: #434343;
      --primary-bg: #232524;
      --highlight: #c1f120;
      --accent: #bfe120;
      --sidebar-bg: #232524e6;
      --panel-bg: #232524f7;
      --font-main: 'Inter', Arial, sans-serif;
      --distance-color: #c1f120;
      --area-color: #43a9ff;
      --volume-color: #ff2d50;
      --sidebar-width: 320px;
    }
    html, body, #cesiumContainer {
      width: 100%; height: 100%; margin: 0; padding: 0;
      font-family: var(--font-main);
      background: var(--primary-bg);
      color: #e6e8e3;
      letter-spacing: 0.01em;
      overscroll-behavior-x: none;
    }
    #cesiumContainer {
      position: absolute; left: 0; top: 0; width: 100%; height: 100%; z-index: 1;
    }
    #sidebar {
      position: fixed; left: 0; top: 0; height: 100%;
      width: var(--sidebar-width);
      background: var(--sidebar-bg);
      color: #e6e8e3;
      z-index: 100;
      overflow-y: auto; box-sizing: border-box;
      box-shadow: 2px 0 24px #0009;
      backdrop-filter: blur(6px);
      border-right: 3px solid var(--primary-green);
      transition: transform 0.28s cubic-bezier(.51,.01,.58,1.11);
    }
    #sidebar h2, #sidebar h3 {
      font-weight: 700;
      letter-spacing: 0.02em;
      margin: 0 0 12px 0;
      color: var(--primary-green);
      text-shadow: 0 1px 6px #0a1f3b33;
    }
    #sidebar h3 { font-size: 1.08rem; margin-top: 32px; }
    #sidebar section { margin-bottom: 28px; }
    #modelList, #layerList {
      list-style: none; padding: 0; margin: 0 0 4px 0;
    }
    #modelList li, #layerList li {
      padding: 11px 14px; border-radius: 12px;
      font-size: 1.04rem; cursor: pointer; margin-bottom: 7px;
      background: transparent;
      transition: background 0.18s, color 0.18s;
      font-weight: 500;
    }
    #modelList li.active, #modelList li:hover, #layerList li:hover {
      background: var(--primary-green); color: #232524;
      box-shadow: 0 2px 12px #c1f12033;
    }
    #layerList li {
      display: flex; align-items: center; justify-content: space-between;
      background: var(--panel-bg);
    }
    #layerList li button {
      background: #b00; color: #fff; border: none; border-radius: 7px; padding: 2px 12px 2px 10px; font-size: 1rem; margin-left: 10px; cursor: pointer;
      transition: background 0.15s;
    }
    #layerList li button:hover { background: #ff2d50; }
    #fileInput {
      background: #181917; color: #eee; border: none; border-radius: 10px; padding: 8px; font-size: 1em;
      margin-bottom: 10px; margin-top: 4px; width: 100%;
      box-shadow: 0 1px 3px #0001;
    }
    #lighting-details-section label {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; font-size: 1.01rem;
      font-weight: 500; color: #f6f8ff;
    }
    #lighting-details-section input[type="range"] {
      width: 160px; margin-left: 12px; accent-color: var(--primary-green);
      background: #232524; border-radius: 7px; height: 3.5px;
      outline: none; box-shadow: 0 1px 2px #0001;
    }
    #lighting-details-section input[type="range"]:focus { outline: 2px solid var(--primary-green); }
    #resetLightingBtn {
      display: block;
      width: 100%;
      background: var(--primary-green); color: #232524;
      border: none; border-radius: 7px;
      padding: 10px 0; font-size: 1.06em; font-weight: 700;
      margin-bottom: 18px;
      cursor: pointer;
      box-shadow: 0 2px 10px #c1f12012; transition: background 0.13s;
    }
    #resetLightingBtn:hover { background: #fff; color: var(--primary-green);}
    #toolbar {
      position: absolute; left: 330px; top: 20px; z-index: 10;
      display: flex; gap: 14px; background: #232524e6;
      border-radius: 14px; box-shadow: 0 1.5px 5px rgba(0,0,0,0.12);
      padding: 9px 16px;
      align-items: center;
    }
    #toolbar button, #toolbar a {
      background: var(--primary-green); color: #232524;
      border: none; border-radius: 7px; padding: 8px 18px; font-size: 1.04rem; font-weight: 600;
      cursor: pointer; transition: background 0.17s, transform 0.14s;
      box-shadow: 0 1.5px 7px #c1f12031;
      text-decoration: none;
      outline: none;
    }
    #toolbar button:hover, #toolbar a:hover {
      background: #fff;
      color: var(--primary-green);
      transform: translateY(-2px) scale(1.04);
    }
    #toolbar button.active {
      background: var(--highlight); color: #232524;
    }
    #measurement-display {
      position: absolute; top: 82px; left: 330px; z-index: 12;
      background: var(--panel-bg); color: #fff; padding: 22px 22px 12px 22px;
      border-radius: 14px; min-width: 240px; max-width: 370px;
      box-shadow: 0 4px 24px 0 rgba(20,20,40,0.12), 0 1.5px 4px rgba(0,0,0,0.05);
      font-size: 1.08rem;
      font-family: var(--font-main);
      margin-top: 6px;
    }
    #measurement-list { margin: 0; padding: 0; list-style: none; }
    #measurement-list li {
      background: #222; margin-bottom: 8px; padding: 7px 11px; border-radius: 7px; display: flex; justify-content: space-between; align-items: center;
      font-size: 1.01em;
      box-shadow: 0 2px 8px #0001;
      border-left: 7px solid var(--primary-green);
      font-weight: 600;
    }
    #measurement-list li[data-type="distance"] { border-left-color: var(--distance-color); }
    #measurement-list li[data-type="area"] { border-left-color: var(--area-color); }
    #measurement-list li[data-type="volume"] { border-left-color: var(--volume-color); }
    #measurement-list button {
      background: #b00; color: #fff; border: none; border-radius: 7px; padding: 2px 11px; font-size: 1rem; margin-left: 10px; cursor: pointer;
      transition: background 0.15s;
    }
    #measurement-list button:hover { background: #ff2d50; }
    #measurement-total {
      font-weight: bold; margin-top:8px; color:var(--highlight); font-size:1.12em; letter-spacing: 0.02em;
    }
    #share-section button {
      margin-bottom: 8px; display:block; width:100%; background: var(--primary-green); color: #232524; font-size:1.06em; font-weight: 600; border-radius: 7px;
      border: none; padding: 9px 0; box-shadow: 0 2px 10px #c1f12012; transition: background 0.13s;
    }
    #share-section button:hover { background: #fff; color: var(--primary-green);}
    #menuBtn {
      display: none;
      background: var(--primary-green); color: #232524; border: none; border-radius: 12px;
      width:48px; height:48px; font-size:2rem; font-weight:700;
      position: fixed; left: 16px; top: 16px; z-index: 200;
      box-shadow: 0 2px 12px #c1f12022; cursor: pointer;
      transition: background 0.13s;
    }
    #sidebarOverlay {
      display: none;
      position: fixed;
      z-index: 101;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.14);
      transition: opacity 0.2s;
    }
    @media (max-width: 900px) {
      #sidebar {
        width: 85vw; max-width:360px; min-width:240px;
        transform: translateX(-100%);
        border-radius: 0 24px 24px 0;
        border-right: none;
      }
      #sidebar.open {
        transform: translateX(0);
        box-shadow: 2px 0 24px #0009;
      }
      #sidebarOverlay.active { display:block; opacity:1; }
      #menuBtn { display:block; }
      #toolbar, #measurement-display { left: 0 !important; }
    }
    @media (min-width: 901px) {
      #menuBtn, #sidebarOverlay { display: none !important; }
      #sidebar { transform:none !important; }
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <button id="menuBtn" aria-label="Open menu">â˜°</button>
  <div id="sidebar" tabindex="-1">
    <h2>Models</h2>
    <ul id="modelList"></ul>
    <section>
      <h3>Data Layers</h3>
      <input type="file" id="fileInput" accept=".kml,.kmz,.glb,.gltf" />
      <ul id="layerList"></ul>
    </section>
    <section id="lighting-details-section">
      <h3>Lighting & Detail</h3>
      <button id="resetLightingBtn" type="button">Reset Lighting</button>
      <label>Detail
        <input type="range" id="detailLevel" min="2" max="32" value="16">
      </label>
      <label>Brightness
        <input type="range" id="brightness" min="0" max="3" value="1" step="0.05">
      </label>
      <label>Contrast
        <input type="range" id="contrast" min="0" max="3" value="1" step="0.05">
      </label>
      <label>Gamma
        <input type="range" id="gamma" min="0.1" max="4" value="2.2" step="0.05">
      </label>
      <label>Saturation
        <input type="range" id="saturation" min="0" max="3" value="1" step="0.05">
      </label>
      <label>Whites
        <input type="range" id="whites" min="-0.5" max="0.5" value="0" step="0.01">
      </label>
      <label>WB
        <input type="range" id="whiteBalance" min="-1" max="1" value="0" step="0.05">
      </label>
    </section>
    <section id="share-section">
      <h3>Share</h3>
      <button id="copyLinkBtn" title="Copy Link">Copy Link</button>
      <button id="whatsappShareBtn" title="Share on WhatsApp">WhatsApp</button>
      <button id="gmailShareBtn" title="Share via Email">Email</button>
    </section>
  </div>
  <div id="sidebarOverlay"></div>
  <div id="toolbar">
    <a href="#" id="backBtn">Back</a>
    <button id="recenterBtn">Recenter</button>
    <button id="fullscreenBtn">Fullscreen</button>
    <button id="distanceBtn">Distance</button>
    <button id="areaBtn">Area</button>
    <button id="volumeBtn">Volume</button>
    <button id="clearBtn">Clear</button>
  </div>
  <div id="measurement-display">
    <div>Select a tool to begin.</div>
    <ul id="measurement-list"></ul>
    <div id="measurement-total"></div>
  </div>
  <script>
    // --- Mobile/Tablet: sidebar swipe-in/out and overlay ---
    document.addEventListener('DOMContentLoaded', function(){
      const sidebar = document.getElementById('sidebar');
      const menuBtn = document.getElementById('menuBtn');
      const overlay = document.getElementById('sidebarOverlay');
      let startX = null, dragging = false;

      function openSidebar() {
        sidebar.classList.add('open');
        overlay.classList.add('active');
        sidebar.focus();
      }
      function closeSidebar() {
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
      }
      menuBtn.onclick = openSidebar;
      overlay.onclick = closeSidebar;

      // Swipe gesture for opening sidebar (from edge)
      window.addEventListener('touchstart', function(e) {
        if (window.innerWidth > 900) return;
        if (e.touches[0].clientX < 24 && !sidebar.classList.contains('open')) {
          startX = e.touches[0].clientX; dragging = true;
        }
      });
      window.addEventListener('touchmove', function(e) {
        if (window.innerWidth > 900 || !dragging) return;
        let dx = e.touches[0].clientX - startX;
        if (dx > 60) { openSidebar(); dragging = false; }
      });
      window.addEventListener('touchend', function() { dragging = false; });

      // Swipe left to close when sidebar is open
      sidebar.addEventListener('touchstart', function(e) {
        if (window.innerWidth > 900) return;
        startX = e.touches[0].clientX;
      });
      sidebar.addEventListener('touchmove', function(e) {
        if (window.innerWidth > 900 || !sidebar.classList.contains('open')) return;
        let dx = e.touches[0].clientX - startX;
        if (dx < -50) { closeSidebar(); }
      });

      // Optional: close sidebar when focus leaves panel (accessibility)
      sidebar.addEventListener('blur', function(){ if(window.innerWidth<=900) closeSidebar(); });

      // Also allow closing with ESC key
      window.addEventListener('keydown', function(e){
        if(e.key === "Escape" && sidebar.classList.contains('open')) closeSidebar();
      });
    });

    // --- Auto fullscreen on mobile/tablet ---
    function isMobileOrTablet() {
      return window.innerWidth <= 900 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }
    function tryAutoFullscreen() {
      if (isMobileOrTablet() && !Cesium.Fullscreen.fullscreen) {
        const elem = document.getElementById('cesiumContainer');
        if (Cesium.Fullscreen.supportsFullscreen && elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
          elem.msRequestFullscreen();
        }
      }
    }
    document.addEventListener('DOMContentLoaded', tryAutoFullscreen);

    // ---- (Cesium, model/lighting/tools JS as in previous answer, omitted here for brevity) ----
    // >>>> Paste the JavaScript from the previous complete viewer.html here <<<<

    // For brevity, use the script block from the previous answer that includes Cesium setup,
    // model loading, lighting, measurement tools, etc. (with your model URL and token).
  </script>
</body>
</html>